apiVersion: v1
kind: ConfigMap
metadata:
  name: monitoring-collector
  namespace: kube-system
  annotations:
    caicloud.io/monitoring.module: collector
data:
  prometheus-number: "1"
  prometheus-template.yaml: |-
    apiVersion: v1
    kind: PodTemplate
    metadata:
      name: prometheus
      namespace: kube-system
    template:
      metadata:
        annotations:
          caicloud.io/monitoring.module: collector
      spec:
        containers:
          - name: prometheus
            image: {{ monitoring_image_prometheus }}
            imagePullPolicy: Always
            ports:
              - containerPort: 9090
                name: web
            volumeMounts:
              - name: prometheus-config
                mountPath: /etc/prometheus
            args:
              - "-config.file=/etc/prometheus/prometheus.yml"
              - "-storage.local.path=/prometheus"
              - "-web.console.libraries=/usr/share/prometheus/console_libraries"
              - "-web.console.templates=/usr/share/prometheus/consoles"
          - name: event-exporter
            image: {{ monitoring_image_event_exporter }}
            imagePullPolicy: Always
            ports:
              - containerPort: 9100
                name: event
            args:
              - "--web.listen-address=:9100"
          - name: hierarchy-exporter
            image: {{ monitoring_image_hierarchy_exporter }}
            imagePullPolicy: Always
            ports:
              - containerPort: 9101
                name: hierarchy
            args:
              - "--web.listen-address=:9101"
        volumes:
          - name: prometheus-config
            configMap:
              name: prometheus-config
