apiVersion: v1
kind: ReplicationController
metadata:
  name: monitoring-watcher
  namespace: kube-system
  labels:
    k8s-app: monitoring-watcher
    version: v1
    kubernetes.io/cluster-service: "true"
    kubernetes-admin.caicloud.io/type: application
    kubernetes-admin.caicloud.io/application: monitoring-watcher
spec:
  replicas: 1
  selector:
    k8s-app: monitoring-watcher
    version: v1
  template:
    metadata:
      labels:
        k8s-app: monitoring-watcher
        version: v1
        kubernetes.io/cluster-service: "true"
        kubernetes-admin.caicloud.io/application: monitoring-watcher
        kubernetes-admin.caicloud.io/type: application
    spec:
      containers:
        - image: {{ monitoring_image_watcher }}
          name: monitoring-watcher
          imagePullPolicy: Always
          resources:
            # keep request = limit to keep this container in guaranteed class
            limits:
              cpu: 50m
              memory: 50Mi
            requests:
              cpu: 20m
              memory: 50Mi
          env:
            - name: K8S_IP
              value: ""
            - name: K8S_USER
              value: ""
            - name: K8S_PASS
              value: ""
            - name: K8S_INSECURE
              value: ""
            - name: PAGING_URL
              value: {{ paging_url }}
            - name: RUNNING_ENVIRONMENT
              value: {{ running_enviroment }}
            - name: INFLUXDB_URL
              value: http://monitoring-influxdb:8086
            - name: INTERVAL
              value: "30"
            - name: SERVICE_PORT
              value: "6090"
            - name: AUTH_REQUIRED
              value: "Y"
            - name: CLUSTER_ID
              value: {{ cluster_id }}
            - name: USER_ID
              value: {{ caicloud_uid }}
            - name: CLUSTER_TOKEN
              value: {{ cluster_token }}
            - name: CLUSTER_NAME
              value: {{ cluster_name }}
            - name: MONGODB_URL
              value: monitoring-server-mongo:27017
            - name: NETWORK_CHECKER_PODS_NUM
              value: "{{ network_checker_pods_num }}"
            - name: NETWORK_CHECKER_PUBLIC_HOST
              value: {{ network_checker_public_host }}
            - name: ENABLE_PUBLIC_NETWORK_CHECK
              value: "{{ enable_public_network }}"
            - name: NETWORK_CHECKER_MINION_IMAGE
              value: {{ monitoring_image_network_checker_minion }}
