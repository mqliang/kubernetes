apiVersion: v1
kind: Pod
metadata:
  name: master-nfs-server
  labels:
    role: master-nfs-server
spec:
  containers:
  - name: nfs-server
    image: {{ nfs_server_image }}
    imagePullPolicy: Always
{% if nfs_dirs is defined %}
    args:
{% for argv in nfs_dirs %}
      - {{ argv }}
{% endfor %}{% endif %}
{% if nfs_root_dir is defined %}
    env:
      - name: NFS_ROOT_DIR
        value: {{ nfs_root_dir }}
{% endif %}
    ports:
      - name: nfs
        containerPort: 2049
      - name: mountd
        containerPort: 20048
      - name: rpcbind
        containerPort: 111
    securityContext:
      privileged: true
    volumeMounts:
      - mountPath: /exports
        name: fake-persistent-storage
  volumes:
    - name: fake-persistent-storage
      hostPath:
        path: /data/nfs-server
